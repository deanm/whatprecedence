/*
 (c) 2014 dean@gmail.com */
var h=20;function l(c,a,d,b){return{a:a,f:b,c:function(b,d){if(0===a)throw"error in operator led";this.type="op_b"+c;this.left=b;this.right=d.b(a,d);return this},d:function(a){if(0===d)throw"error in operator nud";this.type="op_u"+c;this.left=a.b(d,a);return this}}}function p(c,a,d){return l(c,a,d,"left")}function r(c,a,d){return{type:"val_"+c,left:a,i:d,c:function(){throw"led called on a value token.";},d:function(){return this}}}function s(c,a){return r("int",c,a)}
function u(c,a){return r("flt",c,a)}function x(c){return{type:"fun",c:function(){throw"Internal error: led called on a function.";},d:function(a){this.left=c;this.right=a.b(2,a);return this}}}function y(c){return{type:"sym",left:c,c:function(){throw"Internal error: led called on a variable.";},d:function(){return this}}}function z(c){return{type:"typecast",c:function(){throw"Internal error: led called on a function.";},d:function(a){this.left=c;this.right=a.b(3,a);return this}}}
function A(c){function a(){var g=c[b];if(b+1<k){var e=g+c[b+1];if(b+2<k){var f=e+c[b+2];switch(f){case "<<=":case ">>=":return b+=3,l(f,16.1,0,"right")}}switch(e){case "++":case "--":return b+=2,{type:"op_u"+e,a:2,c:function(a){this.type+="suffix";this.f="left";this.left=a;return this},d:function(a){this.type+="prefix";this.f="right";this.left=a.b(3,a);return this}};case "->":return b+=2,p(e,2,0);case "<<":case ">>":return b+=2,p(e,7,0);case "<=":case ">=":return b+=2,p(e,8,0);case "==":case "!=":return b+=
2,p(e,9,0);case "&&":return b+=2,p(e,13,0);case "||":return b+=2,p(e,14,0);case "+=":case "-=":case "*=":case "/=":case "%=":case "&=":case "^=":case "|=":return b+=2,p(e,16,0)}}switch(g){case ".":return++b,p(g,2,0);case "!":case "~":return++b,p(g,0,3);case "*":return++b,p(g,5,3);case "/":case "%":return++b,p(g,5,0);case "+":case "-":return++b,p(g,6,3);case "&":return++b,p(g,10,3);case "^":return++b,p(g,11,0);case "|":return++b,p(g,12,0);case ")":case "]":return++b,{type:g,a:h,c:function(){throw"Internal error: led called on ')'";
},d:function(){throw"Internal error: nud called on ')'";}};case "(":case "[":++b;e=d();if("("===g&&e&&"sym"===e.type&&(-1!==v.indexOf(e.left)||-1!==w.indexOf(e.left))){for(e=[];;)if(f=a(),null!==f){if(")"===f.type)break;if("sym"!==f.type||-1===v.indexOf(f.left)&&-1===w.indexOf(f.left))throw"Unexpected non-typey symbol in typecast: "+f.left;e.push(f.left)}return z(e.join(" "))}return{type:g,a:80,c:function(){throw"Interal error, led called on "+g;},d:function(a){var b=a.b(h-1,a);if("("===g&&")"!==
a.e().type||"["===g&&"]"!==a.e().type)throw"Unmatched left parenthesis/bracket.";a.advance();return b}};case "?":return++b,{type:"op_t?:",f:"right",a:15,c:function(a,b){this.left=a;this.k=b.b(h-1,b);if(":"!==b.e().type)throw"Unmatched : for ?.";b.advance();this.right=b.b(h-1,b);return this},d:function(){throw"nud";}};case ":":return++b,{type:":"};case "=":return++b,l(g,16.1,0,"right");case ",":return++b,l(g,18.1,0,"right");case " ":case "\t":case "\r":case "\n":return++b,null}for(var f=3,n=m.length;f<
n;f+=4)if(e=m[f-3],null!==(e=c.slice(b).match(e))){var n=m[f-2],D=m[f],t="",f=(0,m[f-1])(e[0]);b+=e[0].length;null!==(e=c.slice(b).match(n))&&(t=e[0],b+=t.length);return D(f,t)}if(null!==(e=c.slice(b).match(q)))return f=e[0],b+=f.length,e=d(),(e&&"("===e.type?x:y)(f);throw"Failed in processing input: "+c.slice(b);}function d(){for(var c=b;b<k;){var d=a();if(null!==d)return b=c,d}b=c;return null}var b=0,k=c.length,q=/^[a-zA-Z_][a-zA-Z0-9_]*/,n=/^[uU][lL]?|[uU](?:ll|LL)|[lL][uU]?|(?:ll|LL)[uU]?/,m=
[/^(?:[0-9]*\.[0-9]+|[0-9]+\.)(?:[eE][+-]?[0-9]+)?|^[0-9]+[eE][+-]?[0-9]+/,/^[fFlL]/,parseFloat,u,/^0[xX][0-9a-fA-F]+/,n,function(a){return parseInt(a,16)},s,/^0[0-7]*/,n,function(a){return parseInt(a,8)},s,/^[1-9][0-9]*/,n,function(a){return parseInt(a,10)},s],v=["signed","unsigned","short","long"],w="bool;char;int;float;double;wchar_t;char16_t;char32_t;_Bool;float_t;double_t;int8_t, uint8_t;int16_t, uint16_t;int32_t, uint32_t;int64_t, uint64_t;intptr_t, uintptr_t;size_t;ssize_t;ptrdiff_t".split(";");
this.l=function(){for(var c=[];b<k;){var d=a();null!==d&&c.push(d)}return c}}function B(c){c={j:c,g:0,h:function(){return this.g>=this.j.length},e:function(){return this.h()?{a:h,type:"end"}:this.j[this.g]},advance:function(){++this.g},b:function(a,c){if(!c.h()){var b=c.e();c.advance();for(var k=b.d(c);a>c.e().a;)b=c.e(),c.advance(),k=b.c(k,c);return k}}};return c.b(h-1,c)}function C(c,a,d,b,k){var q=E(c+1,d,k);!0===k(c,a,d,b)&&(q="("+q+")");return q}
function E(c,a,d){if(void 0===a)throw"Error parsing input, probably invalid.";switch(a.type){case "val_int":return a.left+""+a.i;case "val_flt":return a.left.toExponential()+""+a.i;case "sym":return a.left;case "fun":return a.left+"("+C(c,"func",a.right,a,d)+")";case "typecast":return"(("+a.left+")"+C(c,"typecast",a.right,a,d)+")";case "op_t?:":return C(c,"left",a.left,a,d)+" ? "+C(c,"middle",a.k,a,d)+" : "+C(c,"right",a.right,a,d);case "op_u++suffix":return C(c,"unary",a.left,a,d)+"++";case "op_u--suffix":return C(c,
"unary",a.left,a,d)+"--";case "op_u++prefix":return"++"+C(c,"unary",a.left,a,d);case "op_u--prefix":return"--"+C(c,"unary",a.left,a,d);default:if("op_u"===a.type.substr(0,4))return a.type.substr(4)+C(c,"unary",a.left,a,d);if("op_b"===a.type.substr(0,4)){var b=" ",k=" ";"op_b->"===a.type&&(b=k="");"op_b,"===a.type&&(b="");return C(c,"left",a.left,a,d)+b+a.type.substr(4)+k+C(c,"right",a.right,a,d)}throw"Internal error, unhandled node: "+a.type+" "+a.value;}}
function F(c,a){function d(a,b,c){return"val_int"!==c.type&&"val_flt"!==c.type&&"sym"!==c.type}function b(a,b,c,m){return 0===a||!1===d(0,0,c)||c.a<m.a||"right"===b&&"right"===m.f&&c.a<=m.a||"left"===b&&"left"===m.f&&c.a<=m.a?!1:!0}return C(0,"root",c,null,a?b:d)}window.parse_c=function(c){c=B((new A(c)).l());console.log(JSON.stringify(c));return[F(c),F(c,!0)]};
