/*
 (c) 2014 dean@gmail.com */
var l=20;function p(){throw"error, invalid led call";}function s(){throw"error, invalid nud call";}function v(d,e,b,a){return{a:"op_b",e:d,g:e,c:a,h:0===e?p:function(b,c){this.b=e;this.left=b;this.right=c.d(e+("right"===a?0.1:0),c);return this},i:0===b?s:function(a){this.a="op_u";this.b=b;this.c="right";this.left=a.d(b,a);return this}}}function w(d,e,b){return v(d,e,b,"left")}function x(d,e,b){return{a:"num",n:d,left:e,r:b,h:p,i:function(){return this}}}
function y(d){return{a:"sym",left:d,h:p,i:function(){return this}}}function z(d,e){return x("int",d,e)}function A(d,e){return x("flt",d,e)}function B(d){return{a:"op_b_typecast",b:3,c:"right",h:p,i:function(e){this.left=y(d);this.right=e.d(3.1,e);return this}}}
function C(d){function e(){var g=d[a];if(a+1<k){var h=g+d[a+1];if(a+2<k){var q=h+d[a+2];switch(q){case "<<=":case ">>=":return a+=3,v(q,16,0,"right")}}switch(h){case "++":case "--":return a+=2,{a:"op_u",e:h,g:2,h:function(a){this.a+="_s";this.b=2;this.c="left";this.left=a;return this},i:function(a){this.c="right";this.b=3;this.left=a.d(3,a);return this}};case "->":return a+=2,w(h,2,0);case "<<":case ">>":return a+=2,w(h,7,0);case "<=":case ">=":return a+=2,w(h,8,0);case "==":case "!=":return a+=2,
w(h,9,0);case "&&":return a+=2,w(h,13,0);case "||":return a+=2,w(h,14,0);case "+=":case "-=":case "*=":case "/=":case "%=":case "&=":case "^=":case "|=":return a+=2,v(h,16,0,"right")}}switch(g){case ".":return++a,w(g,2,0);case "!":case "~":return++a,w(g,0,3);case "*":return++a,w(g,5,3);case "/":case "%":return++a,w(g,5,0);case "+":case "-":return++a,w(g,6,3);case "&":return++a,w(g,10,3);case "^":return++a,w(g,11,0);case "|":return++a,w(g,12,0);case ")":case "]":return++a,{a:g};case "(":++a;if((g=
b())&&"sym"===g.a&&(-1!==t.indexOf(g.left)||-1!==r.indexOf(g.left))){g=[];for(q=h=!1;;){var n=e();if(n!==c){if(")"===n.a)break;if("op_b"===n.a&&"*"===n.e){if(!1===q)throw"* in typecast before any type";g.push("*");h=!0}else if("sym"===n.a&&-1!==t.indexOf(n.left)){if(!0===q)throw"Typecast qualifier after a type";if(!0===h)throw"Typecast qualifier after a *";g.push(n.left);seen_qualifier=!0}else if("sym"===n.a&&-1!==r.indexOf(n.left)){if(!0===q)throw"Typecast type after another type";if(!0===h)throw"Typecast type after a *";
g.push(n.left);q=!0}else throw"Unexpected non-typey symbol in typecast: "+n.a;}}return B(g.join(" "))}return{a:"_paren",g:2,h:function(a,b){var c=null;")"!==b.f().a&&(c=b.d(l,b));if(")"!==b.f().a)throw"Unmatched left parenthesis";b.advance();return{a:"fun",g:2,b:2,c:"left",left:a,right:c}},i:function(a){var b=a.d(l,a);if(")"!==a.f().a)throw"Unmatched left parenthesis";a.advance();return b}};case "[":return++a,{a:"op_b[]",g:2,c:"left",h:function(a,b){this.b=2;var c=b.d(l,b);if("]"!==b.f().a)throw"Unmatched left bracket";
b.advance();this.left=a;this.right=c;return this},i:s};case ":":return++a,{a:":"};case "?":return++a,{a:"op_t",e:"?:",c:"right",g:15,h:function(a,b){this.b=15;this.left=a;this.m=b.d(l-1,b);if(":"!==b.f().a)throw"Unmatched : for ?.";b.advance();this.right=b.d(l-1,b);return this},i:s};case "=":return++a,v(g,16,0,"right");case ",":return++a,v(g,18,0,"right");case " ":case "\t":case "\r":case "\n":return++a,c}h=3;for(q=f.length;h<q;h+=4)if(g=f[h-3],null!==(g=d.slice(a).match(g))){var q=f[h-2],n=f[h],
m="",h=(0,f[h-1])(g[0]);a+=g[0].length;null!==(g=d.slice(a).match(q))&&(m=g[0],a+=m.length);return n(h,m)}if(null!==(g=d.slice(a).match(u)))return g=g[0],a+=g.length,y(g);throw"Failed in processing input: "+d.slice(a);}function b(){for(var b=a;a<k;){var d=e();if(d!==c)return a=b,d}a=b;return null}var a=0,k=d.length,c={},u=/^[a-zA-Z_][a-zA-Z0-9_]*/,m=/^[uU][lL]?|[uU](?:ll|LL)|[lL][uU]?|(?:ll|LL)[uU]?/,f=[/^(?:[0-9]*\.[0-9]+|[0-9]+\.)(?:[eE][+-]?[0-9]+)?|^[0-9]+[eE][+-]?[0-9]+/,/^[fFlL]/,parseFloat,
A,/^0[xX][0-9a-fA-F]+/,m,function(a){return parseInt(a,16)},z,/^0[0-7]*/,m,function(a){return parseInt(a,8)},z,/^[1-9][0-9]*/,m,function(a){return parseInt(a,10)},z],t=["signed","unsigned","short","long"],r="bool;char;int;float;double;wchar_t;char16_t;char32_t;_Bool;float_t;double_t;int8_t, uint8_t;int16_t, uint16_t;int32_t, uint32_t;int64_t, uint64_t;intptr_t, uintptr_t;size_t;ssize_t;ptrdiff_t".split(";");this.q=function(){for(var b=[];a<k;){var d=e();d!==c&&b.push(d)}return b}}
function D(d){d={l:d,j:0,k:function(){return this.j>=this.l.length},f:function(){return this.k()?{g:l,type:"end"}:this.l[this.j]},advance:function(){++this.j},d:function(e,b){if(!b.k()){var a=b.f();b.advance();console.log("rprec: "+e+" exp: "+a.a);var d=a.i(b);console.log("  left: "+d.a);for(console.log("  lprec: "+b.f().g);e>b.f().g;)a=b.f(),b.advance(),console.log("    t: "+a.a),d=a.h(d,b),console.log("    left: "+d.a),console.log("    lprec: "+b.f().g);return d}}};return d.d(l-1,d)}
function E(d,e,b,a,k,c){function u(){-1!==t&&c.push({type:"",text:"(",opt:0===t})}function m(){-1!==t&&c.push({type:"",text:")",opt:0===t})}if(void 0===b)throw"Error parsing input, probably invalid.";var f=b.a,t=k.o(d,e,b,a);++d;switch(f){case "num":e="flt"===b.n?(b.left|0)===b.left?b.left+".0":b.left.toExponential():b.left;c.push({type:"num",desc:"number",text:e});break;case "sym":c.push({type:"sym",desc:"identifier",text:b.left});break;case "fun":f=[null,null,null,null];e="binary operator function call";
a={type:"op_u",text:"(",desc:e,p:f};var r={type:"op_u",text:")",desc:e,p:f};f[0]=c.length;e=E(d,"left",b.left,b,k,c);f[1]=c.length;c.push(a);f[2]=c.length;null!==b.right&&E(d,"fun",b.right,b,k,c);f[3]=c.length;c.push(r);m();break;case "op_b[]":u();f=[null,null,null,null];e="binary operator subscript";a={type:"op_u",text:"[",desc:e,p:f};r={type:"op_u",text:"]",desc:e,p:f};f[0]=c.length;e=E(d,"left",b.left,b,k,c);f[1]=c.length;c.push(a);f[2]=c.length;E(d,"subscript",b.right,b,k,c);f[3]=c.length;c.push(r);
m();break;case "op_b_typecast":u();f=[null,null,null,null];e="binary operator typecast";a={type:"op_u",text:"(",desc:e,p:f};r={type:"op_u",text:")",desc:e,p:f};c.push(a);f[0]=c.length;e=E(d,"left",b.left,b,k,c);f[1]=c.length;c.push(r);f[2]=c.length;E(d,"typecast",b.right,b,k,c);f[3]=c.length;m();break;case "op_u":case "op_u_s":e=b.c+" associative unary operator "+b.e;e={type:f,text:b.e,desc:e,p:[null,null]};u();"op_u"===f&&c.push(e);e.p[0]=c.length;E(d,"op_u"===f?"right":"left",b.left,b,k,c);e.p[1]=
c.length;"op_u_s"===f&&c.push(e);m();break;case "op_b":e=b.c+" associative binary operator "+b.e;u();a=f=" ";if("."===b.e||"->"===b.e)f=a="";","===b.e&&(f="");e={type:"op_b",text:f+b.e+a,desc:e,p:[null,null,null,null]};e.p[0]=c.length;E(d,"left",b.left,b,k,c);e.p[1]=c.length;c.push(e);e.p[2]=c.length;E(d,"right",b.right,b,k,c);e.p[3]=c.length;m();break;case "op_t":e="right associative ternary operator ?:";f=[null,null,null,null,null,null];a={type:"op_t",text:" ? ",desc:e,p:f};r={type:"op_t",text:" : ",
desc:e,p:f};u();f[0]=c.length;E(d,"left",b.left,b,k,c);f[1]=c.length;c.push(a);f[2]=c.length;E(d,"middle",b.m,b,k,c);f[3]=c.length;c.push(r);f[4]=c.length;E(d,"right",b.right,b,k,c);f[5]=c.length;m();break;default:throw"Internal error, unhandled node: "+b.a;}}function F(d){var e=[];E(0,"root",d,null,{o:function(b,a,d,c){return"fun"===a||0===b?-1:"subscript"===a||d.b<c.b||"right"===a&&"right"===c.c&&d.b<=c.b||"left"===a&&"left"===c.c&&d.b<=c.b?0:1}},e);return e}
window.parse_c=function(d){d=D((new C(d)).q());return F(d)};
