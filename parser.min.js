/*
 (c) 2014 dean@gmail.com */
var m=20;function n(){throw"error, invalid led call";}function q(){throw"error, invalid nud call";}function r(c,e,b,a){return{b:"op_b",h:c,a:e,o:e,g:a,d:0===e?n:function(a,b){this.left=a;this.right=b.c(e,b);return this},e:0===b?q:function(a){this.b="op_u";this.o=b;this.left=a.c(b,a);return this}}}function s(c,e,b){return r(c,e,b,"left")}function t(c,e,b){return{b:"num",m:c,left:e,r:b,d:n,e:function(){return this}}}function v(c){return{b:"sym",left:c,d:n,e:function(){return this}}}
function w(c,e){return t("int",c,e)}function z(c,e){return t("flt",c,e)}function A(c){return{b:"fun",d:n,e:function(e){this.left=c;this.right=e.c(2,e);return this}}}function B(c){return{b:"typecast",left:c,d:n,e:function(c){this.right=c.c(3,c);return this}}}
function C(c){function e(){var l=c[a];if(a+1<k){var f=l+c[a+1];if(a+2<k){var g=f+c[a+2];switch(g){case "<<=":case ">>=":return a+=3,r(g,16.1,0,"right")}}switch(f){case "++":case "--":return a+=2,{b:"op_u",h:f,a:2,d:function(a){this.b+="_s";this.g="left";this.left=a;return this},e:function(a){this.g="right";this.left=a.c(3,a);return this}};case "->":return a+=2,s(f,2,0);case "<<":case ">>":return a+=2,s(f,7,0);case "<=":case ">=":return a+=2,s(f,8,0);case "==":case "!=":return a+=2,s(f,9,0);case "&&":return a+=
2,s(f,13,0);case "||":return a+=2,s(f,14,0);case "+=":case "-=":case "*=":case "/=":case "%=":case "&=":case "^=":case "|=":return a+=2,s(f,16,0)}}switch(l){case ".":return++a,s(l,2,0);case "!":case "~":return++a,s(l,0,3);case "*":return++a,s(l,5,3);case "/":case "%":return++a,s(l,5,0);case "+":case "-":return++a,s(l,6,3);case "&":return++a,s(l,10,3);case "^":return++a,s(l,11,0);case "|":return++a,s(l,12,0);case ")":case "]":return++a,{type:l,a:m,d:function(){throw"Internal error: led called on ')'";
},e:function(){throw"Internal error: nud called on ')'";}};case "(":case "[":++a;f=b();if("("===l&&f&&"sym"===f.type&&(-1!==x.indexOf(f.left)||-1!==y.indexOf(f.left))){for(f=[];;)if(g=e(),null!==g){if(")"===g.type)break;if("sym"!==g.type||-1===x.indexOf(g.left)&&-1===y.indexOf(g.left))throw"Unexpected non-typey symbol in typecast: "+g.left;f.push(g.left)}return B(f.join(" "))}return{type:l,a:80,d:function(){throw"Interal error, led called on "+l;},e:function(a){var b=a.c(m-1,a);if("("===l&&")"!==
a.f().type||"["===l&&"]"!==a.f().type)throw"Unmatched left parenthesis/bracket.";a.advance();return b}};case "?":return++a,{b:"op_t",h:"?:",g:"right",a:15,d:function(a,b){this.left=a;this.l=b.c(m-1,b);if(":"!==b.f().type)throw"Unmatched : for ?.";b.advance();this.right=b.c(m-1,b);return this},e:q};case ":":return++a,{type:":"};case "=":return++a,r(l,16.1,0,"right");case ",":return++a,r(l,18.1,0,"right");case " ":case "\t":case "\r":case "\n":return++a,null}for(var g=3,h=p.length;g<h;g+=4)if(f=p[g-
3],null!==(f=c.slice(a).match(f))){var h=p[g-2],F=p[g],u="",g=(0,p[g-1])(f[0]);a+=f[0].length;null!==(f=c.slice(a).match(h))&&(u=f[0],a+=u.length);return F(g,u)}if(null!==(f=c.slice(a).match(d)))return g=f[0],a+=g.length,f=b(),(f&&"("===f.type?A:v)(g);throw"Failed in processing input: "+c.slice(a);}function b(){for(var b=a;a<k;){var c=e();if(null!==c)return a=b,c}a=b;return null}var a=0,k=c.length,d=/^[a-zA-Z_][a-zA-Z0-9_]*/,h=/^[uU][lL]?|[uU](?:ll|LL)|[lL][uU]?|(?:ll|LL)[uU]?/,p=[/^(?:[0-9]*\.[0-9]+|[0-9]+\.)(?:[eE][+-]?[0-9]+)?|^[0-9]+[eE][+-]?[0-9]+/,
/^[fFlL]/,parseFloat,z,/^0[xX][0-9a-fA-F]+/,h,function(a){return parseInt(a,16)},w,/^0[0-7]*/,h,function(a){return parseInt(a,8)},w,/^[1-9][0-9]*/,h,function(a){return parseInt(a,10)},w],x=["signed","unsigned","short","long"],y="bool;char;int;float;double;wchar_t;char16_t;char32_t;_Bool;float_t;double_t;int8_t, uint8_t;int16_t, uint16_t;int32_t, uint32_t;int64_t, uint64_t;intptr_t, uintptr_t;size_t;ssize_t;ptrdiff_t".split(";");this.q=function(){for(var b=[];a<k;){var c=e();null!==c&&b.push(c)}return b}}
function D(c){c={k:c,i:0,j:function(){return this.i>=this.k.length},f:function(){return this.j()?{a:m,type:"end"}:this.k[this.i]},advance:function(){++this.i},c:function(c,b){if(!b.j()){var a=b.f();b.advance();for(var k=a.e(b);c>b.f().a;)a=b.f(),b.advance(),k=a.d(k,b);return k}}};return c.c(m-1,c)}
function E(c,e,b,a,k,d){if(void 0===b)throw"Error parsing input, probably invalid.";var h=b.b;e=k.n(c,e,b,a);++c;switch(h){case "num":d.push({type:"val",text:"flt"===b.m?(b.left|0)===b.left?b.left+".0":b.left.toExponential():b.left});break;case "sym":d.push({type:"sym",text:b.left});break;case "fun":a={type:"op_u",text:b.left,p:[null,null]};d.push(a);e&&d.push({type:"",text:"("});a.p[0]=d.length;E(c,"func",b.right,b,k,d);a.p[1]=d.length;e&&d.push({type:"",text:")"});break;case "op_u":case "op_u_s":a=
{type:h,text:b.h,p:[null,null]};e&&d.push({type:"",text:"("});"op_u"===h&&d.push(a);a.p[0]=d.length;E(c,"unary",b.left,b,k,d);a.p[1]=d.length;"op_u_s"===h&&d.push(a);e&&d.push({type:"",text:")"});break;case "op_b":e&&d.push({type:"",text:"("});a={type:"op_b",text:" "+b.h+" ",p:[null,null,null,null]};a.p[0]=d.length;E(c,"left",b.left,b,k,d);a.p[1]=d.length;d.push(a);a.p[2]=d.length;E(c,"right",b.right,b,k,d);a.p[3]=d.length;e&&d.push({type:"",text:")"});break;case "op_t":h=[null,null,null,null,null,
null];a={type:"op_t",text:" ? ",p:h};var p={type:"op_t",text:" : ",p:h};e&&d.push({type:"",text:"("});h[0]=d.length;E(c,"left",b.left,b,k,d);h[1]=d.length;d.push(a);h[2]=d.length;E(c,"middle",b.l,b,k,d);h[3]=d.length;d.push(p);h[4]=d.length;E(c,"right",b.right,b,k,d);h[5]=d.length;e&&d.push({type:"",text:")"});break;default:throw"Internal error, unhandled node: "+b.type+" "+b.value;}}
function G(c,e){function b(a){return 0!==a}function a(a,b,c,e){return 0===a||0!==a===!1||c.a<e.a||"right"===b&&"right"===e.g&&c.a<=e.a||"left"===b&&"left"===e.g&&c.a<=e.a?!1:!0}var k=[];E(0,"root",c,null,{n:e?a:b},k);return k}window.parse_c=function(c){c=D((new C(c)).q());console.log(JSON.stringify(c));return[G(c),G(c,!0)]};
