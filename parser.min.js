/*
 (c) 2014 dean@gmail.com */
var l=20;function p(){throw"error, invalid led call";}function s(){throw"error, invalid nud call";}function v(d,c,e,a){return{a:"op_b",f:d,i:c,c:a,g:0===c?p:function(e,b){this.b=c;this.left=e;this.right=b.e(c+("right"===a?0.1:0),b);return this},h:0===e?s:function(a){this.a="op_u";this.b=e;this.c="right";this.left=a.e(e,a);return this}}}function w(d,c,e){return v(d,c,e,"left")}function x(d,c,e){return{a:"num",l:d,left:c,r:e,g:p,h:function(){return this}}}
function y(d){return{a:"sym",left:d,g:p,h:function(){return this}}}function z(d,c){return x("int",d,c)}function A(d,c){return x("flt",d,c)}function B(d){return{a:"op_b_typecast",b:3,c:"right",g:p,h:function(c){this.left=y(d);this.right=c.e(3.1,c);return this}}}
function C(d){function c(){var f=d[a];if(a+1<k){var g=f+d[a+1];if(a+2<k){var q=g+d[a+2];switch(q){case "<<=":case ">>=":return a+=3,v(q,16,0,"right")}}switch(g){case "++":case "--":return a+=2,{a:"op_u",f:g,i:2,g:function(a){this.a+="_s";this.b=2;this.c="left";this.left=a;return this},h:function(a){this.c="right";this.b=3;this.left=a.e(3,a);return this}};case "->":return a+=2,w(g,2,0);case "<<":case ">>":return a+=2,w(g,7,0);case "<=":case ">=":return a+=2,w(g,8,0);case "==":case "!=":return a+=2,
w(g,9,0);case "&&":return a+=2,w(g,13,0);case "||":return a+=2,w(g,14,0);case "+=":case "-=":case "*=":case "/=":case "%=":case "&=":case "^=":case "|=":return a+=2,v(g,16,0,"right")}}switch(f){case ".":return++a,w(f,2,0);case "!":case "~":return++a,w(f,0,3);case "*":return++a,w(f,5,3);case "/":case "%":return++a,w(f,5,0);case "+":case "-":return++a,w(f,6,3);case "&":return++a,w(f,10,3);case "^":return++a,w(f,11,0);case "|":return++a,w(f,12,0);case ")":case "]":return++a,{a:f};case "(":++a;if((f=
e())&&"sym"===f.a&&(-1!==t.indexOf(f.left)||-1!==r.indexOf(f.left))){f=[];for(q=g=!1;;){var n=c();if(n!==b){if(")"===n.a)break;if("op_b"===n.a&&"*"===n.f){if(!1===q)throw"* in typecast before any type";f.push("*");g=!0}else if("sym"===n.a&&-1!==t.indexOf(n.left)){if(!0===q)throw"Typecast qualifier after a type";if(!0===g)throw"Typecast qualifier after a *";f.push(n.left);seen_qualifier=!0}else if("sym"===n.a&&-1!==r.indexOf(n.left)){if(!0===q)throw"Typecast type after another type";if(!0===g)throw"Typecast type after a *";
f.push(n.left);q=!0}else throw"Unexpected non-typey symbol in typecast: "+n.a;}}return B(f.join(" "))}return{a:"_paren",i:2,g:function(a,b){var c=null;")"!==b.d().a&&(c=b.e(l,b));if(")"!==b.d().a)throw"Unmatched left parenthesis";b.advance();return{a:"fun",i:2,b:2,c:"left",left:a,right:c}},h:function(a){if(")"===a.d().a)throw"Empty parentheses expression";var b=a.e(l,a);if(")"!==a.d().a)throw"Unmatched left parenthesis";a.advance();return b}};case "[":return++a,{a:"op_b[]",i:2,c:"left",g:function(a,
b){this.b=2;if("]"===b.d().a)throw"Empty subscript";var c=b.e(l,b);if("]"!==b.d().a)throw"Unmatched left bracket";b.advance();this.left=a;this.right=c;return this},h:s};case ":":return++a,{a:":"};case "?":return++a,{a:"op_t",f:"?:",c:"right",i:15,g:function(a,b){this.b=15;this.left=a;this.n=b.e(l-1,b);if(":"!==b.d().a)throw"Unmatched : for ?.";b.advance();this.right=b.e(l-1,b);return this},h:s};case "=":return++a,v(f,16,0,"right");case ",":return++a,v(f,18,0,"right");case " ":case "\t":case "\r":case "\n":return++a,
b}g=3;for(q=h.length;g<q;g+=4)if(f=h[g-3],null!==(f=d.slice(a).match(f))){var q=h[g-2],n=h[g],m="",g=(0,h[g-1])(f[0]);a+=f[0].length;null!==(f=d.slice(a).match(q))&&(m=f[0],a+=m.length);return n(g,m)}if(null!==(f=d.slice(a).match(u)))return f=f[0],a+=f.length,y(f);throw"Failed in processing input: "+d.slice(a);}function e(){for(var e=a;a<k;){var d=c();if(d!==b)return a=e,d}a=e;return null}var a=0,k=d.length,b={},u=/^[a-zA-Z_][a-zA-Z0-9_]*/,m=/^[uU][lL]?|[uU](?:ll|LL)|[lL][uU]?|(?:ll|LL)[uU]?/,h=[/^(?:[0-9]*\.[0-9]+|[0-9]+\.)(?:[eE][+-]?[0-9]+)?|^[0-9]+[eE][+-]?[0-9]+/,
/^[fFlL]/,parseFloat,A,/^0[xX][0-9a-fA-F]+/,m,function(a){return parseInt(a,16)},z,/^0[0-7]*/,m,function(a){return parseInt(a,8)},z,/^[1-9][0-9]*/,m,function(a){return parseInt(a,10)},z],t=["signed","unsigned","short","long"],r="bool;char;int;float;double;wchar_t;char16_t;char32_t;_Bool;float_t;double_t;int8_t, uint8_t;int16_t, uint16_t;int32_t, uint32_t;int64_t, uint64_t;intptr_t, uintptr_t;size_t;ssize_t;ptrdiff_t".split(";");this.q=function(){for(var e=[];a<k;){var d=c();d!==b&&e.push(d)}return e}}
function D(d){d={m:d,k:0,j:function(){return this.k>=this.m.length},d:function(){return this.j()?{i:l,type:"end"}:this.m[this.k]},advance:function(){++this.k},e:function(c,a){if(!a.j()){var d=a.d();a.advance();for(var b=d.h(a);c>a.d().i;)d=a.d(),a.advance(),b=d.g(b,a);return b}}};var c=d.e(l-1,d);if(!d.j())throw"Trailing token: "+d.d().a;return c}
function E(d,c,e,a,k,b){function u(){-1!==t&&b.push({type:"",text:"(",opt:0===t})}function m(){-1!==t&&b.push({type:"",text:")",opt:0===t})}if(void 0===e)throw"Operator missing argument?";var h=e.a,t=k.o(d,c,e,a);++d;switch(h){case "num":h="flt"===e.l?(e.left|0)===e.left?e.left+".0":e.left.toExponential():e.left;c="flt"===e.l?"floating point number":"integer number";b.push({type:"num",desc:c,text:h});break;case "sym":b.push({type:"sym",desc:"identifier",text:e.left});break;case "fun":a=[null,null,
null,null];c="binary operator function call";var r={type:"op_u",text:"(",desc:c,p:a};c={type:"op_u",text:")",desc:c,p:a};a[0]=b.length;h=E(d,"left",e.left,e,k,b);a[1]=b.length;b.push(r);a[2]=b.length;null!==e.right&&E(d,"fun",e.right,e,k,b);a[3]=b.length;b.push(c);m();break;case "op_b[]":u();a=[null,null,null,null];c="binary operator subscript";r={type:"op_u",text:"[",desc:c,p:a};c={type:"op_u",text:"]",desc:c,p:a};a[0]=b.length;h=E(d,"left",e.left,e,k,b);a[1]=b.length;b.push(r);a[2]=b.length;E(d,
"subscript",e.right,e,k,b);a[3]=b.length;b.push(c);m();break;case "op_b_typecast":u();a=[null,null,null,null];c="binary operator typecast";r={type:"op_u",text:"(",desc:c,p:a};c={type:"op_u",text:")",desc:c,p:a};b.push(r);a[0]=b.length;h=E(d,"left",e.left,e,k,b);a[1]=b.length;b.push(c);a[2]=b.length;E(d,"typecast",e.right,e,k,b);a[3]=b.length;m();break;case "op_u":case "op_u_s":c=e.c+" associative unary operator "+e.f;c={type:h,text:e.f,desc:c,p:[null,null]};u();"op_u"===h&&b.push(c);c.p[0]=b.length;
E(d,"op_u"===h?"right":"left",e.left,e,k,b);c.p[1]=b.length;"op_u_s"===h&&b.push(c);m();break;case "op_b":c=e.c+" associative binary operator "+e.f;u();a=h=" ";if("."===e.f||"->"===e.f)h=a="";","===e.f&&(h="");c={type:"op_b",text:h+e.f+a,desc:c,p:[null,null,null,null]};c.p[0]=b.length;E(d,"left",e.left,e,k,b);c.p[1]=b.length;b.push(c);c.p[2]=b.length;E(d,"right",e.right,e,k,b);c.p[3]=b.length;m();break;case "op_t":c="right associative ternary operator ?:";a=[null,null,null,null,null,null];r={type:"op_t",
text:" ? ",desc:c,p:a};c={type:"op_t",text:" : ",desc:c,p:a};u();a[0]=b.length;E(d,"left",e.left,e,k,b);a[1]=b.length;b.push(r);a[2]=b.length;E(d,"middle",e.n,e,k,b);a[3]=b.length;b.push(c);a[4]=b.length;E(d,"right",e.right,e,k,b);a[5]=b.length;m();break;default:throw"Internal error, unhandled node: "+e.a;}}
function F(d){var c=[];E(0,"root",d,null,{o:function(c,a,d,b){return"fun"===a||0===c?-1:"subscript"===a||d.b<b.b||"right"===a&&"right"===b.c&&d.b<=b.b||"left"===a&&"left"===b.c&&d.b<=b.b?0:1}},c);return c}window.parse_c=function(d){d=D((new C(d)).q());return F(d)};
