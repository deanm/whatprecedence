/*
 (c) 2014 dean@gmail.com */
var m=20;function n(){throw"error, invalid led call";}function p(){throw"error, invalid nud call";}function q(d,f,c,a){return{a:"op_b",g:d,d:f,b:a,h:0===f?n:function(c,b){this.c=f;this.left=c;this.right=b.e(f+("right"===a?0.1:0),b);return this},i:0===c?p:function(a){this.a="op_u";this.c=c;this.b="right";this.left=a.e(c,a);return this}}}function s(d,f,c){return q(d,f,c,"left")}function t(d,f,c){return{a:"num",n:d,left:f,r:c,h:n,i:function(){return this}}}
function u(d){return{a:"sym",left:d,h:n,i:function(){return this}}}function w(d,f){return t("int",d,f)}function x(d,f){return t("flt",d,f)}function A(d){return{a:"op_b_typecast",b:"right",h:n,i:function(f){this.left=u(d);this.right=f.e(3.1,f);return this}}}
function B(d){function f(){var g=d[a];if(a+1<k){var h=g+d[a+1];if(a+2<k){var l=h+d[a+2];switch(l){case "<<=":case ">>=":return a+=3,q(l,16,0,"right")}}switch(h){case "++":case "--":return a+=2,{a:"op_u",g:h,d:2,h:function(a){this.a+="_s";this.c=2;this.b="left";this.left=a;return this},i:function(a){this.b="right";this.c=3;this.left=a.e(3,a);return this}};case "->":return a+=2,s(h,2,0);case "<<":case ">>":return a+=2,s(h,7,0);case "<=":case ">=":return a+=2,s(h,8,0);case "==":case "!=":return a+=2,
s(h,9,0);case "&&":return a+=2,s(h,13,0);case "||":return a+=2,s(h,14,0);case "+=":case "-=":case "*=":case "/=":case "%=":case "&=":case "^=":case "|=":return a+=2,q(h,16,0,"right")}}switch(g){case ".":return++a,s(g,2,0);case "!":case "~":return++a,s(g,0,3);case "*":return++a,s(g,5,3);case "/":case "%":return++a,s(g,5,0);case "+":case "-":return++a,s(g,6,3);case "&":return++a,s(g,10,3);case "^":return++a,s(g,11,0);case "|":return++a,s(g,12,0);case ")":case "]":return++a,{a:g};case "(":++a;if((g=
c())&&"sym"===g.a&&(-1!==y.indexOf(g.left)||-1!==z.indexOf(g.left))){for(g=[];;)if(h=f(),null!==h){if(")"===h.a)break;if("sym"!==h.a||-1===y.indexOf(h.left)&&-1===z.indexOf(h.left))throw"Unexpected non-typey symbol in typecast: "+h.left;g.push(h.left)}return A(g.join(" "))}return{a:"_paren",d:2,h:function(a,b){var c=null;")"!==b.f().a&&(c=b.e(m,b));if(")"!==b.f().a)throw"Unmatched left parenthesis";b.advance();return{a:"fun",d:2,c:2,b:"left",left:a,right:c}},i:function(a){var b=a.e(m,a);if(")"!==
a.f().a)throw"Unmatched left parenthesis";a.advance();return b}};case "[":return++a,{a:"op_b[]",d:2,b:"left",h:function(a,b){this.c=2;var c=b.e(m,b);if("]"!==b.f().a)throw"Unmatched left bracket";b.advance();this.left=a;this.right=c;return this},i:p};case ":":return++a,{a:":"};case "?":return++a,{a:"op_t",g:"?:",b:"right",d:15,h:function(a,b){this.c=15;this.left=a;this.m=b.e(m-1,b);if(":"!==b.f().a)throw"Unmatched : for ?.";b.advance();this.right=b.e(m-1,b);return this},i:p};case "=":return++a,q(g,
16,0,"right");case ",":return++a,q(g,18,0,"right");case " ":case "\t":case "\r":case "\n":return++a,b}h=3;for(l=r.length;h<l;h+=4)if(g=r[h-3],null!==(g=d.slice(a).match(g))){var l=r[h-2],D=r[h],v="",h=(0,r[h-1])(g[0]);a+=g[0].length;null!==(g=d.slice(a).match(l))&&(v=g[0],a+=v.length);return D(h,v)}if(null!==(g=d.slice(a).match(e)))return g=g[0],a+=g.length,u(g);throw"Failed in processing input: "+d.slice(a);}function c(){for(var c=a;a<k;){var d=f();if(d!==b)return a=c,d}a=c;return null}var a=0,k=
d.length,b={},e=/^[a-zA-Z_][a-zA-Z0-9_]*/,l=/^[uU][lL]?|[uU](?:ll|LL)|[lL][uU]?|(?:ll|LL)[uU]?/,r=[/^(?:[0-9]*\.[0-9]+|[0-9]+\.)(?:[eE][+-]?[0-9]+)?|^[0-9]+[eE][+-]?[0-9]+/,/^[fFlL]/,parseFloat,x,/^0[xX][0-9a-fA-F]+/,l,function(a){return parseInt(a,16)},w,/^0[0-7]*/,l,function(a){return parseInt(a,8)},w,/^[1-9][0-9]*/,l,function(a){return parseInt(a,10)},w],y=["signed","unsigned","short","long"],z="bool;char;int;float;double;wchar_t;char16_t;char32_t;_Bool;float_t;double_t;int8_t, uint8_t;int16_t, uint16_t;int32_t, uint32_t;int64_t, uint64_t;intptr_t, uintptr_t;size_t;ssize_t;ptrdiff_t".split(";");
this.q=function(){for(var c=[];a<k;){var d=f();d!==b&&c.push(d)}return c}}
function C(d){d={l:d,j:0,k:function(){return this.j>=this.l.length},f:function(){return this.k()?{d:m,type:"end"}:this.l[this.j]},advance:function(){++this.j},e:function(d,c){if(!c.k()){var a=c.f();c.advance();console.log("rprec: "+d+" exp: "+a.a);var k=a.i(c);console.log("  left: "+k.a);for(console.log("  lprec: "+c.f().d);d>c.f().d;)a=c.f(),c.advance(),console.log("    t: "+a.a),k=a.h(k,c),console.log("    left: "+k.a),console.log("    lprec: "+c.f().d);return k}}};return d.e(m-1,d)}
function E(d,f,c,a,k,b){if(void 0===c)throw"Error parsing input, probably invalid.";var e=c.a;f=!k.o(d,f,c,a);++d;switch(e){case "num":b.push({type:"num",desc:"number",text:"flt"===c.n?(c.left|0)===c.left?c.left+".0":c.left.toExponential():c.left});break;case "sym":b.push({type:"sym",desc:"identifier",text:c.left});break;case "fun":b.push({type:"",text:"(",opt:f});e=[null,null,null,null];a="binary operator function call";var l={type:"op_u",text:"(",desc:a,p:e};a={type:"op_u",text:")",desc:a,p:e};
e[0]=b.length;E(d,"left",c.left,c,k,b);e[1]=b.length;b.push(l);e[2]=b.length;null!==c.right&&E(d,"fun",c.right,c,k,b);e[3]=b.length;b.push(a);b.push({type:"",text:")",opt:f});break;case "op_b[]":b.push({type:"",text:"(",opt:f});e=[null,null,null,null];a="binary operator subscript";l={type:"op_u",text:"[",desc:a,p:e};a={type:"op_u",text:"]",desc:a,p:e};e[0]=b.length;E(d,"left",c.left,c,k,b);e[1]=b.length;b.push(l);e[2]=b.length;E(d,"subscript",c.right,c,k,b);e[3]=b.length;b.push(a);b.push({type:"",
text:")",opt:f});break;case "op_b_typecast":b.push({type:"",text:"(",opt:f});e=[null,null,null,null];a="binary operator typecast";l={type:"op_u",text:"(",desc:a,p:e};a={type:"op_u",text:")",desc:a,p:e};b.push(l);e[0]=b.length;E(d,"left",c.left,c,k,b);e[1]=b.length;b.push(a);e[2]=b.length;E(d,"subscript",c.right,c,k,b);e[3]=b.length;b.push({type:"",text:")",opt:f});break;case "op_u":case "op_u_s":a=c.b+" associative unary operator "+c.g;a={type:e,text:c.g,desc:a,p:[null,null]};b.push({type:"",text:"(",
opt:f});"op_u"===e&&b.push(a);a.p[0]=b.length;E(d,"unary",c.left,c,k,b);a.p[1]=b.length;"op_u_s"===e&&b.push(a);b.push({type:"",text:")",opt:f});break;case "op_b":a=c.b+" associative binary operator "+c.g;b.push({type:"",text:"(",opt:f});l=e=" ";if("."===c.g||"->"===c.g)e=l="";","===c.g&&(e="");a={type:"op_b",text:e+c.g+l,desc:a,p:[null,null,null,null]};a.p[0]=b.length;E(d,"left",c.left,c,k,b);a.p[1]=b.length;b.push(a);a.p[2]=b.length;E(d,"right",c.right,c,k,b);a.p[3]=b.length;b.push({type:"",text:")",
opt:f});break;case "op_t":a="right associative ternary operator ?:";e=[null,null,null,null,null,null];l={type:"op_t",text:" ? ",desc:a,p:e};a={type:"op_t",text:" : ",desc:a,p:e};b.push({type:"",text:"(",opt:f});e[0]=b.length;E(d,"left",c.left,c,k,b);e[1]=b.length;b.push(l);e[2]=b.length;E(d,"middle",c.m,c,k,b);e[3]=b.length;b.push(a);e[4]=b.length;E(d,"right",c.right,c,k,b);e[5]=b.length;b.push({type:"",text:")",opt:f});break;default:throw"Internal error, unhandled node: "+c.a;}}
function F(d){var f=[];E(0,"root",d,null,{o:function(c,a,d,b){var e;(e=0===c)||(e=!1===("fun"!==a&&0!==c));return e||d.d<b.d||"unary"===a&&"right"===b.b&&d.c<=b.c||"right"===a&&"right"===b.b&&d.c<=b.c||"left"===a&&"left"===b.b&&d.c<=b.c?!1:!0}},f);return f}window.parse_c=function(d){d=C((new B(d)).q());return F(d)};
